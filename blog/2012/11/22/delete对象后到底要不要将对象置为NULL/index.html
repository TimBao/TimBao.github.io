
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>delete对象后到底要不要将对象置为NULL - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="delete对象后到底要不要将对象置为NULL">
  <meta name="keywords" content="C++技术">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://timbao.github.io/blog/2012/11/22/delete%E5%AF%B9%E8%B1%A1%E5%90%8E%E5%88%B0%E5%BA%95%E8%A6%81%E4%B8%8D%E8%A6%81%E5%B0%86%E5%AF%B9%E8%B1%A1%E7%BD%AE%E4%B8%BANULL">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:timbao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">delete对象后到底要不要将对象置为NULL</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-11-22T22:31:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2012</span></span> <span class='time'>10:31 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p> 以下是我的一个美国同事丹尼尔对此的看法：</p>

<p>  Member pointers do NOT have to be set to NULL in a destructor. A destructor, as its name implies, destroys an object and the object can’t be accessed after that. So accessing anything (even if it were a pointer set to NULL) is absolutely wrong. I usually take
 setting pointers to NULL out of destructors because it is not needed. If an object gets accessed after it is destroyed, in any form, than it has to be tracked down. But NOT by accessing any of its member variables.</p>

<p>   对象指针不需要设置为NULL在析构函数中。析构函数，顾名思义，销毁一个对象而之后该对象不在被使用到。所以存取任何东西（即使指针被设置为NULL）都是绝对的错误。我一般都将设置指针为NULL的语句从析构函数中移除，因为它并不被需要。如果一个对象能够在它被销毁后存取，那么这将能被追查出。但是不是因为存取它里面的任何成员。</p>

<pre><code> 对此他还写了个小程序来证明他的观点：


   class A
</code></pre>

<p>{
public:</p>

<pre><code>// Constructor
A()
{
    m_pMember = new int;
}

// Destructor
~A()
{
    delete m_pMember;

    // UNNECESSARY: You can't access that pointer after the destructor!
    m_pMember = NULL;
}

int* m_pMember;
</code></pre>

<p>};</p>

<p>int <em>tmain(int argc, </em>TCHAR<em> argv[])
{
    // Instantiate
    A</em> pA = new A;</p>

<pre><code>// Destroy, destructor gets called!
delete pA;

// THIS IS WRONG, you can't access m_pMember anymore. You can't even check if for NULL!
// This probably won't crash in 99%  of the cases, but it can crash!
if (pA-&gt;;m_pMember)
{
    // Do something
}

  return 0;
</code></pre>

<p>}</p>

<pre><code>     看起来他的程序的确能证明他的观点。但是他忘记了一点，关于对象的copying。如果对象pA在delete之前copying给了其他对象，那么结果可是大不一样啊！让我们稍微改动下程序再看看效果:


     class A
</code></pre>

<p>{
public:
    A() { m_pMember = new int;}
    ~A() {
        delete m_pMember;
    }</p>

<pre><code>int* m_pMember;
</code></pre>

<p>};</p>

<p>int <em>tmain(int argc, </em>TCHAR<em> argv[])
{
    A</em> pA = new A();
    A* pB = pA;
    delete pA;</p>

<pre><code>if (pB-&gt;;m_pMember)
{
    int temp = *pB-&gt;;m_pMember; //Crash
}
return 0;
</code></pre>

<p>}</p>

<pre><code>      这还只是个简单的情况，如果涉及到多线程或者多模块如多个dll之间传递对象，那么就极有可能因为某一对象已经销毁后，没有设置为NULL导致程序Crash。在这里还是建议各位一定要谨慎处理指针问题，避免引起不必要的奇怪问题。
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      




<time class='entry-date' datetime='2012-11-22T22:31:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2012</span></span> <span class='time'>10:31 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c-plus-plus-ji-zhu/'>c++技术</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://timbao.github.io/blog/2012/11/22/delete%E5%AF%B9%E8%B1%A1%E5%90%8E%E5%88%B0%E5%BA%95%E8%A6%81%E4%B8%8D%E8%A6%81%E5%B0%86%E5%AF%B9%E8%B1%A1%E7%BD%AE%E4%B8%BANULL/" data-via="" data-counturl="http://timbao.github.io/blog/2012/11/22/delete%E5%AF%B9%E8%B1%A1%E5%90%8E%E5%88%B0%E5%BA%95%E8%A6%81%E4%B8%8D%E8%A6%81%E5%B0%86%E5%AF%B9%E8%B1%A1%E7%BD%AE%E4%B8%BANULL/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/11/15/ListBox%E5%88%B7%E6%96%B0%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98/" title="Previous Post: ListBox刷新闪烁问题">&laquo; ListBox刷新闪烁问题</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/11/27/%E4%BD%BF%E7%94%A8List%EF%BC%9A%EF%BC%9Aunique()%E4%BB%A3%E6%9B%BF%E5%BE%AA%E7%8E%AF%E5%88%A4%E6%96%AD/" title="Next Post: 使用List：：unique()代替循环判断">使用List：：unique()代替循环判断 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/06/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%EF%BC%8C%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">工欲善其事，必先利其器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/30/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/">字符串相关函数整理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/19/Android%20NDK%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E9%94%99%E8%AF%AF/">Android NDK帮助文档的一个小错误</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/09/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%B8%8D%E6%98%AF%E6%93%8D%E4%BD%9C%E5%B7%A5/">程序员不是操作工</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/02/%E6%B5%85%E6%9E%90%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/">浅析移动开发</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
