
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>逝水流年</title>
  <meta name="author" content="Tim Bao">

  
  <meta name="description" content="1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
NSMutableArray* array1 = [[NSMutableArray alloc] init];
NSMutableArray* array2 = [[ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://timbao.github.io/posts/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="逝水流年" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">逝水流年</a></h1>
  
    <h2>This is a blog to record my life, my work, my feeling &#8230;</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:timbao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">归档</a></li>
  <li><a href="/about">关于</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/15/NSMutableArray%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/">NSMutableArray使用中遇到的内存问题</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-03-15T23:58:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>11:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSMutableArray* array1 = [[NSMutableArray alloc] init];
</span><span class='line'>NSMutableArray* array2 = [[NSMutableArray alloc] init];
</span><span class='line'>- (void)pushs:(NSInteger)VALUE {
</span><span class='line'>    BOOL find = NO;
</span><span class='line'>    [array2 removeAllObjects];
</span><span class='line'>    for (NSNumber* item in array1) {
</span><span class='line'>        NSInteger value = [item intValue];
</span><span class='line'>        if (value == VALUE) {
</span><span class='line'>            [array1 removeAllObjects];
</span><span class='line'>            [array1 addObjectsFromArray: array2];
</span><span class='line'>            [array1 addObject: item];
</span><span class='line'>            find = YES;
</span><span class='line'>            break;
</span><span class='line'>        }
</span><span class='line'>        else {
</span><span class='line'>            [array2 addObject: item];
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    if (!find) {
</span><span class='line'>        NSNumber* newItem = [NSNumber numberWithInt: VALUE];
</span><span class='line'>        [viewTypeArray addObject:newItem];
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>当进入if (value == VALUE)后，[array1 addObject: value];执行完毕后，查看array1中的元素类型发现已经不再是NSNumber<em>而是变为NSobject</em>,取出使用报错，bad access。</p>

<p>该问题出现的几率比较随机。单独使用没有任何问题，放到整个工程中就出现问题。通过查看内存，发现NSMutableArray中存储的为NSNumber指针，array1和array2中指针地址一致，有可能是当[array1 removeAllObjects];后，item有可能被自动销毁，导致加入到array1中的值出现错误。修改为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSNumber* topItem = [NSNumber numberWithInt: value];
</span><span class='line'>[array1 addObject:topItem];</span></code></pre></td></tr></table></div></figure>


<p>问题解决。这个问题的根本原因还是内存的问题，objective-c的内存管理比较特殊，有很多隐藏的内存分配和自动回收，个人怀疑numberWithInt方法返回的NSNumber*对象为autorelease。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/03/15/NSMutableArray%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/'>http://timbao.github.io/blog/2012/03/15/NSMutableArray%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/06/strcmp,%20stricmp%20%E2%80%94%20compare%20strings./">Strcmp, Stricmp — Compare Strings.</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-03-06T21:33:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>9:33 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Returns</p>

<p>A negative number if the first string is ordinally less than the second string according to the ASCII character set, a positive number if the first string is greater than the second, and zero if the two strings are exactly equal.</p>

<p>Description</p>

<p>These functions can be used as comparison functions for sort and insert.</p>

<p>stricmp performs the same function as strcmp, but alphabetic characters are compared without regard to case. That is, &ldquo;A&rdquo; and &ldquo;a&rdquo; are considered equal by stricmp, but different by strcmp.</p>

<p>简单来说，strcmp区分大小写而stricmp不区分大小写而已。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/03/06/strcmp,%20stricmp%20%E2%80%94%20compare%20strings./'>http://timbao.github.io/blog/2012/03/06/strcmp,%20stricmp%20%E2%80%94%20compare%20strings./</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/29/stdswap/">Std::swap</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-29T01:13:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>1:13 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>template &lt;class T&gt;; void swap ( T& a, T& b );</span></code></pre></td></tr></table></div></figure>


<p>Exchange values of two objects(交换两个对象的值)</p>

<p>Assigns the content of a to b and the content of b to a.
（将a的内容给b，将b的内容给a。）</p>

<p>The behavior of this function template is equivalent to:
（该函数模板的实现如下：）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>template &lt;class T&gt;; void swap ( T& a, T& b )
</span><span class='line'>{
</span><span class='line'>    T c(a); a=b; b=c;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Notice how this function involves a copy construction and two assignment operations, which may not be the most efficient way of swapping the contents of classes that store large quantities of data, since each of these operations generally operate in linear time on their size.</p></blockquote>

<p>（注意，该函数是通过调用一个拷贝构造函数和两个赋值操作来交换两个对象的内容，这并不是最高效的交换方法对大数据来说，因为每个操作时间都是跟对象大小的成正比的线性时间关系。）</p>

<blockquote><p>Because this function template is used as a primitive operation by many other algorithms, it is highly recommended that large data types overload their own specialization of this function. Notably, all STL containers define such specializations (at least for the standard allocator), in such a way that instead of swapping their entire data content, only the values of a few internal pointers are swapped, making this operation to operate in real constant time with them. Parameters a, b Two objects, whose contents are swapped. The type must be copy constructible and support assignment operations.</p></blockquote>

<p>（类型T必须包含拷贝构造和支持赋值操作。）</p>

<blockquote><p>Return value none</p></blockquote>

<p>Example</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// swap algorithm example
</span><span class='line'>#include &lt;iostream&gt;;
</span><span class='line'>#include &lt;algorithm&gt;;
</span><span class='line'>#include &lt;vector&gt;;
</span><span class='line'>using namespace std;
</span><span class='line'>int main ()
</span><span class='line'>{
</span><span class='line'>    int x=10, y=20;                         // x:10 y:20
</span><span class='line'>    swap(x,y);                              // x:20 y:10
</span><span class='line'>    vector&lt;int&gt;; first (4,x), second (6,y);  // first:4x20 second:6x10
</span><span class='line'>    swap(first,second);                     // first:6x10 second:4x20
</span><span class='line'>    cout &lt;&lt; "first contains:";
</span><span class='line'>    for (vector&lt;int&gt;;::iterator it=first.begin(); it!=first.end(); ++it)
</span><span class='line'>        cout &lt;&lt; " " &lt;&lt; *it;
</span><span class='line'>    cout &lt;&lt; endl;
</span><span class='line'>    return 0;
</span><span class='line'>}
</span><span class='line'>Output:
</span><span class='line'>first contains: 10 10 10 10 10 10</span></code></pre></td></tr></table></div></figure>


<p>Complexity
    Constant: Performs exactly one copy construction and two assignments (although notice that each of these operations works on its own complexity).</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/02/29/stdswap/'>http://timbao.github.io/blog/2012/02/29/stdswap/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/26/%E6%88%91%E7%9A%84%E2%80%9C%E8%90%A5%E9%94%80%E2%80%9D%E5%BC%80%E5%A7%8B/">我的“营销”开始</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-26T06:44:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>6:44 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>原本快乐的生活在年后完全被打乱了，不再有时间更新博客微薄，不再有时间看书学习，不再有时间睡懒觉，不再有时间看电影、看电视，完全脱离的轨道。一周5天工作，纯脑力劳动，一坐8个多小时对着电脑面对代码，这些都不再是工作，反倒是休息是开心；晚上要加班洗衣服，基本没有12点之前睡觉的，还好没在原单位上班，不然严重睡眠不足；周末要做的事情就更多了，不过基本都是体力劳动，大包小包的衣服都我来拎，累的我的胳膊一疼就是一周，这周更牛掰，我开始了我的销售生涯，从小区挨家挨户发小广告做起！</p>

<p>今天一共发了将近10栋楼，300户左右，那叫一个累啊，退都上下楼上的不利索了。就当锻炼了，既要锻炼到上半身也要锻炼到下半身嘛，哈哈。苦中作乐！希望生意越来越好吧。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/02/26/%E6%88%91%E7%9A%84%E2%80%9C%E8%90%A5%E9%94%80%E2%80%9D%E5%BC%80%E5%A7%8B/'>http://timbao.github.io/blog/2012/02/26/%E6%88%91%E7%9A%84%E2%80%9C%E8%90%A5%E9%94%80%E2%80%9D%E5%BC%80%E5%A7%8B/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/04/%E5%B9%B4%E5%90%8E%E5%B0%8F%E8%81%9A/">年后小聚</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-04T07:01:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>7:01 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>很开心！好久没有这么畅快的谈心了！ 过去的日子，有一般好友陪伴，真的很幸运。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/02/04/%E5%B9%B4%E5%90%8E%E5%B0%8F%E8%81%9A/'>http://timbao.github.io/blog/2012/02/04/%E5%B9%B4%E5%90%8E%E5%B0%8F%E8%81%9A/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/01/20120130%E5%B7%A5%E4%BD%9C%E5%B0%8F%E7%BB%93/">20120130工作小结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-01T04:56:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>4:56 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>除了checked_delete外，今天还学习了两点内容：</p>

<p>1、char<em> strdup(char</em> s); 函数，使用malloc方法，拷贝一个新的s，返回，需要使用free释放；还有类似的strndup等。</p>

<p>2、bundle：Iphone开发中bundle是一个目录，其中包含了程序会使用到的资源，这些资源包括了图像，声音，编译好的代码，nib文件（用户也会把bundle称为plug-in），cocoa框架提供了NSBundle类来对其进行操作。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/02/01/20120130%E5%B7%A5%E4%BD%9C%E5%B0%8F%E7%BB%93/'>http://timbao.github.io/blog/2012/02/01/20120130%E5%B7%A5%E4%BD%9C%E5%B0%8F%E7%BB%93/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/01/Imcomplete%20class%20type%20delete%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A0%E9%99%A4%EF%BC%89/">Imcomplete Class Type Delete（不完整类类型的删除）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-01T04:51:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>4:51 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>当delete不完整类类型对象的时候，不会调用对象的析构函数，导致内存泄漏。所以要避免delete 不确定类型。</p>

<p>首先解释下不完整类类型Imcomplete class type：只见声明不见定义的类、结构体或是联合体；相对应的就是complete type，就是编译器可以确定的类型。</p>

<p>下面举例说明：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//delete_object.h
</span><span class='line'>class CObject;
</span><span class='line'>void delete_object(CObject* pObj); //p为imcomplete type
</span><span class='line'>//delete_object.cpp
</span><span class='line'>void delete_object(CObject* pObj) {delete pObj;}
</span><span class='line'>//CObject.h
</span><span class='line'>class CObject
</span><span class='line'>{
</span><span class='line'>    //destructor
</span><span class='line'>    ~CObject()
</span><span class='line'>    {
</span><span class='line'>        //destructor called.
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>//main file
</span><span class='line'>#include "delete_object.h"
</span><span class='line'>#include "CObject.h"
</span><span class='line'>int main(int argc, char[] argv)
</span><span class='line'>{
</span><span class='line'>    CObject* pObj = new CObject();
</span><span class='line'>    delete_object(pObj);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>这里的pObj对象在delete的时候就是不确定对象，编译器不知道它的类型，无法调用析构函数，最终导致内存泄漏。解决的最简单的方法，就是在delete_object.cpp文件中增加#include “CObject.h”语句即可。</p>

<p>我们这里要重点介绍的是boost库中的使用的方法，方法使用的非常巧妙。整理如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//utiles.h
</span><span class='line'>template&lt;typename T&gt;;
</span><span class='line'>inline void checked_delete(T * x)
</span><span class='line'>{
</span><span class='line'>    // intentionally complex - simplification causes regressions
</span><span class='line'>    typedef char type_must_be_complete[ sizeof(T)? 1: -1 ];
</span><span class='line'>    (void) sizeof(type_must_be_complete);
</span><span class='line'>    delete x;
</span><span class='line'>}
</span><span class='line'>template&lt;typename T&gt;;
</span><span class='line'>inline void checked_arraydelete(T * x)
</span><span class='line'>{
</span><span class='line'>    // intentionally complex - simplification causes regressions
</span><span class='line'>    typedef char type_must_be_complete[ sizeof(T)? 1: -1 ];
</span><span class='line'>    (void) sizeof(type_must_be_complete);
</span><span class='line'>    delete[] x;
</span><span class='line'>}
</span><span class='line'>template&lt;typename T&gt;;
</span><span class='line'>struct checked_deleter
</span><span class='line'>{
</span><span class='line'>    typedef void result_type;
</span><span class='line'>    typedef T * argument_type;
</span><span class='line'>    void operator()(T * p) const
</span><span class='line'>    {
</span><span class='line'>        checked_delete(p);
</span><span class='line'>    }
</span><span class='line'>};
</span><span class='line'>template&lt;typename T&gt;;
</span><span class='line'>struct checked_arraydeleter
</span><span class='line'>{
</span><span class='line'>    typedef void result_type;
</span><span class='line'>    typedef T * argument_type;
</span><span class='line'>    void operator()(T * p) const
</span><span class='line'>    {
</span><span class='line'>        checked_arraydelete(p);
</span><span class='line'>    }
</span><span class='line'>};
</span><span class='line'>//main file
</span><span class='line'>//#include "delete_object.h"
</span><span class='line'>#include "CObject.h"
</span><span class='line'>#include "utiles.h"
</span><span class='line'>int main(int argc, char[] argv)
</span><span class='line'>{
</span><span class='line'>    CObject* pObj = new CObject();
</span><span class='line'>    //delete_object(pObj);
</span><span class='line'>    checked_deleter&lt;CObject&gt;;(p);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>既能在静态编译时监测出delete是否有问题，也可以安全的删除，不用再担心内存泄漏了！</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/02/01/Imcomplete%20class%20type%20delete%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A0%E9%99%A4%EF%BC%89/'>http://timbao.github.io/blog/2012/02/01/Imcomplete%20class%20type%20delete%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A0%E9%99%A4%EF%BC%89/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/31/20120130%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">20120130工作记录</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-01-31T03:58:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>3:58 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>plist文件的作用还真是不少，今天就接触到两点：</p>

<p>1、设置App启动界面，在plist中add row，name=Launch Image，Value=XXX.png。</p>

<p>2、设置status bar样式，name=status bar style，value=opaque black sytle等三种。</p>

<p>  等同于代码[application setStatusBarStyle:UIStatusBarStyleBlackOpaque];</p>

<p>  UINavigationController：使用堆栈方式来管理UIViewController。适用与层次化工作流。</p>

<p>  [self.navigationController pushViewChontroller:nextController animated:YES];</p>

<p>  [self.navigationController popViewControllerAnimated:YES];</p>

<p>  UITabBarController：适用与各部分相对比较对立的情况。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/01/31/20120130%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/'>http://timbao.github.io/blog/2012/01/31/20120130%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/30/STL%E4%B9%8BTrim/">STL之Trim</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-01-30T06:09:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>6:09 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天无意之间看到了通用类的三个函数，是用STL实现字符串去掉首尾空格，方法用的颇为简洁，记录下来分享和学习下。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#include &lt;string&gt;;</span>
</span><span class='line'><span class="cp">#include &lt;algorithm&gt;;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span><span class="o">&amp;</span>  <span class="n">lTrim</span><span class="p">(</span><span class="n">string</span>   <span class="o">&amp;</span><span class="n">ss</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">string</span><span class="o">::</span><span class="n">iterator</span>   <span class="n">p</span><span class="o">=</span><span class="n">find_if</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">ss</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">not1</span><span class="p">(</span><span class="n">ptr_fun</span><span class="p">(</span><span class="n">isspace</span><span class="p">)));</span>
</span><span class='line'>    <span class="n">ss</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">p</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span>  <span class="n">ss</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span><span class="o">&amp;</span>  <span class="n">rTrim</span><span class="p">(</span><span class="n">string</span>   <span class="o">&amp;</span><span class="n">ss</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">string</span><span class="o">::</span><span class="n">reverse_iterator</span>  <span class="n">p</span><span class="o">=</span><span class="n">find_if</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span><span class="n">ss</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span><span class="n">not1</span><span class="p">(</span><span class="n">ptr_fun</span><span class="p">(</span><span class="n">isspace</span><span class="p">)));</span>
</span><span class='line'>    <span class="n">ss</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">base</span><span class="p">(),</span><span class="n">ss</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span><span class='line'>    <span class="k">return</span>   <span class="n">ss</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span><span class="o">&amp;</span>   <span class="n">trim</span><span class="p">(</span><span class="n">string</span>   <span class="o">&amp;</span><span class="n">st</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">lTrim</span><span class="p">(</span><span class="n">rTrim</span><span class="p">(</span><span class="n">st</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span>   <span class="n">st</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/01/30/STL%E4%B9%8BTrim/'>http://timbao.github.io/blog/2012/01/30/STL%E4%B9%8BTrim/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/19/20120118%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/">20120118工作总结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-01-19T06:55:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>6:55 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这两天老大给分配了新的任务，学习最新的NBI-MapKit，编写地图DEMO，激动，终于要开始编程了。SDK很简单，一个MapKit.framwork，包含两个文件MapKit.docset和MapKit.framework。包括6个headers和一个静态库，真的很简单。</p>

<p>再细看docset，发现模块也不是特别多，但是接口多的不行，在原有的CCI基础上又包装一层，以后值做UI了，</p>

<p>方便了开发但是学到的东西就少了。以后还得学习底层开发。自己捣鼓了一下午，终于学会了如何导入framework和.a库，如何设置编译选项，丫的编译还是有问题。已经完全按照说明做了，郁闷。</p>

<p>今天把错误跟QA说了下，原来丫的给我的版本不对。没办法，根据她给我的WEB SITE，自己注册下载了最新的SDK，哈哈把Sample也一起下载了，爽。果断重建工程，在buildphase中加入framework和.a及相关的几个framework和库，加上编译条件-lstdc++，编译，successed！耶。</p>

<p>下面就开始UI布局了，按照原来的UI样子，学着使用Interface Builder进行UI设计，娘的，跟使用MFC做界面一样麻烦，弄了半天才弄好了一个Navigation和ToolBar，最后弄好了Tray。可以鱼目混珠啦。哈哈，做了个假的Map。</p>

<p>这两天学到了如何建立Iphone工程，如何导入第三方库和framework，如何设置编译选项，如何使用UIView等控件进行界面设计。东西很杂，但是都是基础，还需锻炼。尤其是对整个工程的架构上面来看，还不是很熟练，在年前这几天争取要把UI全部做出来，先不考虑架构，只做UI和基本功能，等基本功能做完后可以考虑第一次重构将架构重新设计，这时候应该轻车熟路了。</p>

<p class='post-footer'>
             原文地址:
             <a href='http://timbao.github.io/blog/2012/01/19/20120118%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/'>http://timbao.github.io/blog/2012/01/19/20120118%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/</a><br/>
             written by <a href='http://timbao.github.io'>Tim Bao</a>
             &nbsp;posted at <a href='http://timbao.github.io'>http://timbao.github.io</a>
             </p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Tim Bao</h1>
  <p>Software development, iOS and Android development, design and management.</p>
</section>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/10/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BB%8E%E4%B8%80%E4%B8%AA%E8%88%92%E9%80%82%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%A6%BB%E5%BC%80/">2015-02-10 为什么要从一个舒适的工作环境中离开</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/06/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%EF%BC%8C%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">工欲善其事，必先利其器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/30/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/">字符串相关函数整理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/19/Android%20NDK%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E9%94%99%E8%AF%AF/">Android NDK帮助文档的一个小错误</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/09/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%B8%8D%E6%98%AF%E6%93%8D%E4%BD%9C%E5%B7%A5/">程序员不是操作工</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>文章分类</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/android/'>android (1)</a></li>
<li class='category'><a href='/blog/categories/android-ndk/'>android ndk (1)</a></li>
<li class='category'><a href='/blog/categories/bcb学习/'>bcb学习 (2)</a></li>
<li class='category'><a href='/blog/categories/c--技术/'>c++技术 (38)</a></li>
<li class='category'><a href='/blog/categories/cmmi实施/'>cmmi实施 (3)</a></li>
<li class='category'><a href='/blog/categories/cstring--string-h-函数介绍/'>cstring (string.h)函数介绍 (2)</a></li>
<li class='category'><a href='/blog/categories/iphone-objective-c/'>iphone/objective-c (4)</a></li>
<li class='category'><a href='/blog/categories/mfc学习/'>mfc学习 (2)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (3)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (2)</a></li>
<li class='category'><a href='/blog/categories/windows-8/'>windows 8 (6)</a></li>
<li class='category'><a href='/blog/categories/其他技术问题/'>其他技术问题 (3)</a></li>
<li class='category'><a href='/blog/categories/感悟/'>感悟 (1)</a></li>
<li class='category'><a href='/blog/categories/移动开发/'>移动开发 (1)</a></li>
<li class='category'><a href='/blog/categories/记事/'>记事 (33)</a></li>
<li class='category'><a href='/blog/categories/设计模式学习/'>设计模式学习 (2)</a></li>
<li class='category'><a href='/blog/categories/读书笔记/'>读书笔记 (3)</a></li>
<li class='category'><a href='/blog/categories/重构技术/'>重构技术 (2)</a></li>
<li class='category'><a href='/blog/categories/项目管理/'>项目管理 (1)</a></li>

  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/TimBao">@TimBao</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'TimBao',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Tim Bao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
